document.addEventListener('DOMContentLoaded', () => {
  // ========== 1) Full, enriched history content (eras) ==========
  // Detailed narrative, monuments, Sikh history, cultural impact, conservation notes.
  // Works with Prev/Next (era-labeled) and Jump-to-era select.
  const historyData = {
    

  'ancient': {
    title: 'рикрйБри░ри╛ридрии риЕридрйЗ риорй▒ризриХри╛ри▓рйАрии риХри╛ри▓',
    content: `
      <h4>ЁЯМЯ рикрй▒риЯрйА рижри╛ рикрйБри░ри╛ригри╛ риЗридри┐ри╣ри╛ри╕: ри╕рйМриЦрйА рикрй░риЬри╛римрйА ри╡ри┐рй▒риЪ риЬри╛ригрйЛ ЁЯХ░я╕П</h4>
      <p>рикрй▒риЯрйА ри╕ри╝ри╣ри┐ри░, риЬрйЛ риХри┐ рикрй░риЬри╛рим рижрйЗ ридри░рии ридри╛ри░рии риЬри╝ри┐ри▓рйНри╣рйЗ ри╡ри┐рй▒риЪ ри╡ри╕ри┐риЖ ри╣рйЛриЗриЖ ри╣рйИ, риЗрй▒риХ риЕриЬри┐ри╣ри╛ риЗридри┐ри╣ри╛ри╕риХ ри╕ри╝ри╣ри┐ри░ ри╣рйИ риЬри┐ри╕рижрйАриЖриВ риЬрйЬрйНри╣ри╛риВ риХриИ ри╕рижрйАриЖриВ рикрйБри░ри╛ригрйАриЖриВ ри╣рииред риЗри╣ ридри░рии ридри╛ри░рии ри╕ри╛ри╣ри┐рим рижрйЗ риирйЗрйЬрйЗ риЕридрйЗ риЕрй░риорйНри░ри┐ридри╕ри░ ридрйЛриВ ри▓риЧринриЧ 47 риХри┐ри▓рйЛриорйАриЯри░ рижрйА рижрйВри░рйА 'ридрйЗ ри╕риери┐рид ри╣рйИ, риЕридрйЗ риЗри╕рижрйА рикри╛риХри┐ри╕ридри╛рии риири╛ри▓ риЕрй░ридри░ри░ри╛ри╕ри╝риЯри░рйА ри╕ри░ри╣рй▒риж ридрйЛриВ риирйЗрйЬридри╛ риирйЗ риЗри╕рижрйЗ риЗридри┐ри╣ри╛ри╕ риирйВрй░ ри╣рйЛри░ ри╡рйА риЦри╛ри╕ римригри╛риЗриЖ ри╣рйИред риорй░риири┐риЖ риЬри╛риВрижри╛ ри╣рйИ риХри┐ рикрй▒риЯрйА рижри╛ риЗридри┐ри╣ри╛ри╕ ри▓риЧринриЧ риЗрй▒риХ ри╣риЬри╝ри╛ри░ ри╕ри╛ри▓ рикрйБри░ри╛ригри╛ ри╣рйИ, риЬрйЛ рикрй░риЬри╛рим рижрйЗ риори╛риЭри╛ риЦрйЗридри░ ри╡ри┐рй▒риЪ риЗри╕рижрйА ри▓рй░риорйА риЕридрйЗ рикрйНри░ринри╛ри╡ри╕ри╝ри╛ри▓рйА риорйМриЬрйВрижриЧрйА риирйВрй░ рижри░ри╕ри╛риЙриВрижри╛ ри╣рйИред</p>
      <h4>рикрй▒риЯрйА: риири╛рио риЕридрйЗ рикрйБри░ри╛ригрйА ри╕ри╝ри╛рии</h4>
      <p>риорйВри▓ ри░рйВрик ри╡ри┐рй▒риЪ "рикрй▒риЯрйА ри╣рйИримридрикрйБри░ри╛" ри╡риЬрйЛриВ риЬри╛ригри┐риЖ риЬри╛риВрижри╛, риЗри╣ ри╕ри╝ри╣ри┐ри░ ри╕риорйЗриВ рижрйЗ риири╛ри▓ риЫрйЛриЯри╛ ри╣рйЛ риХрйЗ ри╕ри┐ри░рилри╝ рикрй▒риЯрйА ри░ри╣ри┐ риЧри┐риЖред рикрй░риЬри╛римрйА ри╡ри┐рй▒риЪ "рикрй▒риЯрйА" рижри╛ риЕри░рие "риЧри▓рйА" риЬри╛риВ риЦрйЗридри░рйА рикрй▒риЯрйА ри╣рйИ, риЬрйЛ ри╕ри╝ри╣ри┐ри░ рижрйА риЧри▓рйАриЖриВ-риХрйЗриВрижри░ри┐рид римригридри░ риЕридрйЗ ри╡рикри╛ри░риХ ри╕ри░риЧри░риорйАриЖриВ риири╛ри▓ риЬрйБрйЬрижри╛ ри╣рйИред ри▓рйЛриХ-ри╕рй░ри╕риХрйНри░ри┐ридрйА ри╡ри┐рй▒риЪ "рикрй▒риЯрйА" words риХриИ ри╡ри╛ри░ ри╡рй░ри╕ри╝/рикри░ри┐ри╡ри╛ри░риХ ри╕риорйВри╣ри╛риВ ри▓риИ ри╡рйА ри╡ри░ридри┐риЖ риЬри╛риВрижри╛ ри╣рйИ, риЗри╕ ри▓риИ рикрй▒риЯрйА рижрйА ри╕рй▒ринри┐риЖриЪри╛ри░риХ-ри╕риори╛риЬри┐риХ римригридри░ ри╡ри┐рй▒риЪ рикри░ри┐ри╡ри╛ри░риХ ризри╛ри░ри╛ри╡ри╛риВ рижрйА риЭри▓риХ риори┐ри▓рижрйА ри╣рйИред</p>
      <p>рикрйБри░ри╛ригрйЗ риЬри╝риори╛риирйЗ ри╡ри┐рй▒риЪ рикрй▒риЯрйА "риирйМ ри▓рй▒риЦрйА рикрй▒риЯрйА" ри╡рйА риХри┐ри╣ри╛ риЬри╛риВрижри╛ ри╕рйАтАФринри╛ри╡ риХри┐ риЗрй▒риерйЛриВ рижри╛ ри╕ри╛ри▓ри╛риири╛ ринрйВриорйА-ри░ри╛риЬри╕ри╡/риЖриорижрии римри╣рйБрид риЙрй▒риЪрйА ри╕рйА (ри▓риЧринриЧ риирйМ ри▓рй▒риЦ ри░рйБрикриП), риЬри┐ри╕ риири╛ри▓ риЗри╕риирйВрй░ рикрй░риЬри╛римрйА ри░ри╛риЬриирйАридриХ риЕридрйЗ ри╡рикри╛ри░риХ риириХри╕ри╝рйЗ тАШридрйЗ риЦри╛ри╕ риери╛риВ риори┐ри▓рйАред</p>
      <h4>ри╕риери╛риири┐риХ ринрйВриЧрйЛри▓ риЕридрйЗ римри╕ридрйАриЖриВ</h4>
      <p>рикрй▒риЯрйА риЗрй▒риХ риори┐риЯрйАри▓рйЗ риЯри┐рй▒ри▓рйЗ тАШридрйЗ римрй▒ри╕ри┐риЖ рижрй▒ри╕ри┐риЖ риЬри╛риВрижри╛ ри╣рйИ; ри╕ри╝ри╣ри┐ри░ рижрйЗ рижрй▒риЦриг-рикрйВри░рим рикри╛ри╕рйЗ риЗрй▒риХ ри╣рйЛри░ риЙрй▒риЪри╛ риЯрйАри▓ри╛ ри╣рйИ риЬри┐рй▒риерйЗ риЗрй▒риХ рикрйБри░ри╛ридрии ри╕ри╝ри┐ри╡ риорй░рижри░ рижрйА рикри░рй░рикри░ри┐риХ ри╕рйВриЪриири╛ риори┐ри▓рижрйА ри╣рйИред риЗри╣ римри╣рйБризри╛ри░риори┐риХ ри╡ри┐ри░ри╛ри╕рид риЕридрйЗ рикрйБри░ри╛ридрй▒ридри╡риХ ри╕рй░ринри╛ри╡риири╛ри╡ри╛риВ риирйВрй░ рижри░ри╕ри╛риЙриВрижри╛ ри╣рйИред</p>
    `,
    map: "https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d27233.84138791328!2d74.86949983238525!3d31.1937777812888!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x391a7bc88a09f1cf%3A0x947c8934934efc8f!2sPatti%2C%20Punjab%20143416!5e0!3m2!1sen!2sin!4v1708548734338!5m2!1sen!2sin"
  },

  'mughal': {
    title: 'риорйБриЧри▓ риХри╛ри▓',
    content: `
      <h4>риорйБриЧри▓ риХри╛ри▓ риЕридрйЗ рижрйБриирйА риЪрй░риж рижри╛ риХри┐ри▓рйНри╣ри╛</h4>
      <p>риорйБриЧри▓ риХри╛ри▓ рижрйМри░ри╛рии, рикрй▒риЯрйА риирйЗ риЗрй▒риХ риори╣рй▒ридри╡рикрйВри░рии рикрйНри░ри╕ри╝ри╛ри╕риХрйА ринрйВриори┐риХри╛ риири┐ринри╛риИ, риЬри┐рй▒риерйЗ рикрй░риЬри╛рим рижри╛ риорйБриЧри▓ риЧри╡ри░риири░ ри╡рйА ри░ри╣ри┐рй░рижри╛ ри╕рйАред риЕрй▒риЬ ри╡рйА ри╕ри╝ри╣ри┐ри░ ри╡ри┐рй▒риЪ риорйБриЧри▓ рижрйМри░ рижрйАриЖриВ риЗриори╛ри░ридри╛риВ риЕридрйЗ риЕри╡ри╕ри╝рйЗри╕ри╝ рижрйЗриЦриг риирйВрй░ риори┐ри▓рижрйЗ ри╣рииред риЗрй▒риерйЗ риЗрй▒риХ рикрйБри░ри╛ригри╛ риХри┐ри▓рйНри╣ри╛ ри╣рйИ, риЬри┐ри╕риирйВрй░ рикри╣ри┐ри▓ри╛риВ ри░ри╛риП/ри░ри╛риЬри╛ рижрйБриирйА риЪрй░риж рижрйА ри╣ри╡рйЗри▓рйА риХри┐ри╣ри╛ риЬри╛риВрижри╛ ри╕рйАред</p>
      <h4>римрйАримрйА ри░риЬриирйА риЬрйА рижрйА риХри╣ри╛ригрйА</h4>
      <p>рижрйБриирйА риЪрй░риж рижрйА ри╕рин ридрйЛриВ риЫрйЛриЯрйА ризрйА римрйАримрйА ри░риЬриирйА риирйЗ риРри▓ри╛рии риХрйАридри╛ риХри┐ риЕри╕ри▓ рикри╛ри▓ригри╣ри╛ри░ риЕриХри╛ри▓ рикрйБри░риЦ ри╡ри╛ри╣ри┐риЧрйБри░рйВ ри╣рйИ; риири╛ри░ри╛риЬри╝ рикри┐ридри╛ риирйЗ риЙри╕рижри╛ ри╡ри┐риЖри╣ риЗрй▒риХ риХрйЛрйЬрйНри╣рйА риири╛ри▓ риХри░ рижри┐рй▒ридри╛ред римрйАримрйА риЬрйА риирйЗ риЖрикригрйЗ рикридрйА риирйВрй░ рижрйБрй▒риЦ римрй░риЬриирйА римрйЗри░рйА ри╡ри╛ри▓рйЗ ридри▓ри╛рим тАШриЪ риЗри╕ри╝риири╛рии риХри░ри╡ри╛риЗриЖ, риЬри┐риерйЗ риЪриоридриХри╛ри░рйА ридрйМри░ тАШридрйЗ риЙри╣ риЪрй░риЧри╛ ри╣рйЛ риЧри┐риЖтАФриЗри╣ риЙри╣рйА риери╛риВ ри╣рйИ риЬри┐риерйЗ римри╛риЕриж ри╡ри┐рй▒риЪ ри╣ри░ри┐риорй░рижри░ ри╕ри╛ри╣ри┐рим рижри╛ рикри╡ри┐рй▒ридри░ ри╕ри░рйЛри╡ри░ ри╡ри┐риХри╕ри┐рид ри╣рйЛриЗриЖред риЗри╣ риХриери╛ рикрй▒риЯрйА риирйВрй░ ри╕ри┐рй▒риЦ ризри╛ри░риори┐риХ риЗридри┐ри╣ри╛ри╕ риири╛ри▓ рибрйВрй░риШрйА рибрйЛри░ риири╛ри▓ риЬрйЛрйЬрижрйА ри╣рйИред</p>
      <h4>риорйАри░ риорй░риирйВ риЕридрйЗ риЬрйБри▓рио рижрйАриЖриВ рижри╕ридри╛риири╛риВ</h4>
      <p>риорйБриЧри▓ рижрйМри░ рижрйЗ ри╕рйВримри╛рижри╛ри░ри╛риВ ри╡ри┐рй▒риЪ риорйАри░ риорй░риирйВ рижри╛ риири╛рио риЬрйБри▓риори╛риВ ри▓риИ риЪри░риЪри┐рид ри╣рйИ; ри╕ри┐рй▒риЦ риЗридри┐ри╣ри╛ри╕ ри╡ри┐рй▒риЪ риЙри╕ ри╕риорйЗриВ рижрйАриЖриВ риХриери╛ри╡ри╛риВ ри╡ри┐рй▒риЪ ри╕ридрйАриЖриВ риЕридрйЗ риори╛ри╕рйВриори╛риВ тАШридрйЗ риЕридри┐риЖриЪри╛ри░ри╛риВ рижрйАриЖриВ ри╡рйАри░ри▓рйАриЖриВ риХри╣ри╛ригрйАриЖриВ ри░рйЛриЬри╝ри╛риири╛ рижрйА риЕри░рижри╛ри╕ рижрйЗ ри╕рй░рижри░рин римриг риЧриИриЖриВред</p>
      <h4>ри╕ри╝ри╣ри┐ри░рйА риври╛риВриЪри╛</h4>
      <p>1755 рижрйЗ риЖри╕-рикри╛ри╕ римригрйЗ риХри┐ри▓рйНри╣рйЗ риири╛ри▓-риири╛ри▓ ри╕ри╝ри╣ри┐ри░ рижрйА римри╛ри╣ри░рйА риХрй░риз риЕридрйЗ риорйБриЧри▓ рижрйМри░ рижрйАриЖриВ ри╣рйЛри░ риЗриори╛ри░ридри╛риВ (риори╕риЬри┐рижри╛риВ/риориХримри░ри┐риЖриВ рижрйЗ риЕри╡ри╕ри╝рйЗри╕ри╝) рикрй▒риЯрйА рижрйЗ рикрйНри░ри╕ри╝ри╛ри╕риХрйА риЕридрйЗ ри╕рйИриири┐риХ риори╣рй▒ридри╡ рижрйА риири┐ри╢ри╛риирижрйЗри╣рйА риХри░рижрйАриЖриВ ри╣риитАФримри╣рйБридрйЗ риЕрй▒риЬ ри╕рй░ри░риХри╕ри╝риг рижрйА риорй░риЧ риХри░ ри░ри╣рйЗ ри╣рииред</p>
    `,
    map: "https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d27233.84138791328!2d74.86949983238525!3d31.1937777812888!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x391a7bc88a09f1cf%3A0x947c8934934efc8f!2sPatti%2C%20Punjab%20143416!5e0!3m2!1sen!2sin!4v1708548734338!5m2!1sen!2sin"
  },

  'sikh': {
    title: 'ри╕ри┐рй▒риЦ ри░ри╛риЬ',
    content: `
      <h4>риори┐ри╕ри▓ри╛риВ рижри╛ ри░ри╛риЬ риЕридрйЗ риори╣ри╛ри░ри╛риЬри╛ ри░ригриЬрйАрид ри╕ри┐рй░риШ рижри╛ рикрйНри░ринри╛ри╡</h4>
      <p>18ри╡рйАриВ ри╕рижрйА ри╡ри┐рй▒риЪ риорйБриЧри▓ ри╕ри╛риори░ри╛риЬ рижрйЗ рикридрии ридрйЛриВ римри╛риЕриж, ри╕ри┐рй▒риЦ риори┐ри╕ри▓ри╛риВ рижри╛ риЙрй▒ринри╛ри░ ри╣рйЛриЗриЖред риЗри╕ рижрйМри░ри╛рии рикрй▒риЯрйА ри╕рй▒ридри╛-ри╕рй░риШри░ри╕ри╝ри╛риВ рижри╛ ри╣ри┐рй▒ри╕ри╛ римригрйА риЕридрйЗ 1755тАУ56 ри╡ри┐рй▒риЪ рилрйИриЬри╝ри▓рикрйБри░рйАриЖ (ри╕ри┐рй░риШрикрйБри░рйАриЖ) риори┐ри╕ри▓ рижрйЗ риЦри╝рйБри╕ри╝ри╛ри▓ ри╕ри┐рй░риШ риирйЗ рикриари╛ригри╛риВ ридрйЛриВ рикрй▒риЯрйА риирйВрй░ риЬри┐рй▒рид ри▓ри┐риЖред римри╛риЕриж ри╡ри┐рй▒риЪ рижрйАри╡ри╛рии риорйЛри╣риХрио риЪрй░риж рижрйА риХриори╛рии ри╣рйЗриа рилрйМриЬ риирйЗ риЗрй▒риерйЗ риХри╛римрйВ риХри░риХрйЗ 1811 ри╡ри┐рй▒риЪ рикрй▒риЯрйА риирйВрй░ риори╣ри╛ри░ри╛риЬри╛ ри░ригриЬрйАрид ри╕ри┐рй░риШ рижрйЗ ри╕ри╛риори░ри╛риЬ ри╡ри┐рй▒риЪ ри╕ри╝ри╛риори▓ риХрйАридри╛ред риХри┐ри╣ри╛ риЬри╛риВрижри╛ ри╣рйИ риХри┐ риШрйЗри░ри╛римрй░рижрйА рижрйМри░ри╛рии римри╛ри╣ри░рйА риХрй░риз рижри╛ ри╣ри┐рй▒ри╕ри╛ риври╣ри┐ риЧри┐риЖред</p>
      <p>риЗри╣ ри╡рйА рижрй▒ри╕ри┐риЖ риЬри╛риВрижри╛ ри╣рйИ риХри┐ риХри┐ри▓рйНри╣рйЗ ри╡ри┐рй▒риЪрйЛриВ риЗрй▒риХ ри╕рйБри░рй░риЧ ри▓ри╛ри╣рйМри░ ри╡рй▒ри▓ риЬри╛риВрижрйА ри╕рйА риЬрйЛ римри╛риЕриж ри╡ри┐рй▒риЪ римрй░риж риХри░ рижри┐рй▒ридрйА риЧриИред риЗрй▒риХ рикри░рй░рикри░ри╛ риЕриирйБри╕ри╛ри░, рижрйБриирйА риЪрй░риж рижрйА ри╣ри╡рйЗри▓рйА риирйВрй░ риЫрйЗри╡рйАриВ рикри╛ридри╕ри╝ри╛ри╣рйА риЧрйБри░рйВ ри╣ри░ри┐риЧрйЛримри┐рй░риж ри╕ри╛ри╣ри┐рим риЬрйА рижрйЗ ри╕рй░риЬрйЛриЧ риири╛ри▓ риХри┐ри▓рйНри╣рйЗ ри╡риЬрйЛриВ риориЬримрйВрид риХрйАридри╛ риЧри┐риЖред</p>

      <h4>рикрй▒риЯрйА рижрйА ри╕ри╝ри╣рйАрижрйА риЕридрйЗ ри╕ри┐рй▒риЦ риЗридри┐ри╣ри╛ри╕</h4>
      <p>риорйБриЧри▓-рикри╕ри╝риЪри╛рид рижриориириХри╛ри░рйА рижрйМри░ри╛риВ ри╡ри┐рй▒риЪ рикрй▒риЯрйА риЕридрйЗ риЗри╕рижри╛ риХри┐ри▓рйНри╣ри╛ ри╕ри┐рй▒риЦ риЬрй▒риерйЗрижри╛ри░ри╛риВ риирйВрй░ ри╕риЬри╝ри╛ри╡ри╛риВ рижрйЗ риХрйЗриВрижри░ ри╡риЬрйЛриВ риЬри╝ри┐риХри░рид ри╣рйИред ри╕ри╝ри╣рйАрижри╛риВ рижрйАриЖриВ риХриери╛ри╡ри╛риВ, риЬри┐ри╡рйЗриВ ринри╛риИ ридри╛ри░рйВ ри╕ри┐рй░риШ риЬрйА рижрйА риЕриЯрй▒ри▓ридри╛, ри╕ри┐рй▒риЦ риЕри░рижри╛ри╕ рижри╛ ри╣ри┐рй▒ри╕ри╛ ри╣рии риЕридрйЗ ри╕риорйВри╣риХ рипри╛риж ри╡ри┐рй▒риЪ рикрй▒риЯрйА рижрйА ринрйВриори┐риХри╛ риирйВрй░ риЕриори░ риХри░рижрйАриЖриВ ри╣рииред</p>

      <h4>римри╛римри╛ римри┐ризрйА риЪрй░риж риЬрйА риири╛ри▓ ри╕рй░римрй░ризрид риЧрйБри░рижрйБриЖри░рйЗ</h4>
      <p><strong>риЧрйБри░рижрйБриЖри░ри╛ ри╕рйНри░рйА риЪрйМримри╛ри░ри╛ ри╕ри╛ри╣ри┐рим</strong>: риХриери╛ риЕриирйБри╕ри╛ри░, ринри╛риИ римри┐ризрйА риЪрй░риж риЬрйА риирйЗ риФри░рид рижри╛ ринрйЗри╕ римрижри▓ риХрйЗ ри╣ри╛риХрио рижрйЗ риШри░рйЛриВ риЧрйБри░рйВ ри╣ри░ри┐риЧрйЛримри┐рй░риж ри╕ри╛ри╣ри┐рим риЬрйА ри▓риИ риЖриП риХрйАриоридрйА рижрйБри╕ри╝ри╛ри▓рйЗ риЪридрйБри░ри╛риИ риири╛ри▓ ри╡ри╛рикри╕ рикрйНри░ри╛рикрид риХрйАридрйЗтАФриЗри╣ риери╛риВ риЕрй▒риЬ риЧрйБри░рижрйБриЖри░рйЗ ри░рйВрик ри╡ри┐рй▒риЪ риори░рипри╛рижри┐рид ри╣рйИред</p>
      <p><strong>риЧрйБри░рижрйБриЖри░ри╛ ри╕рйНри░рйА ринрй▒риа ри╕ри╛ри╣ри┐рим</strong>: ринрй▒риЬрижри┐риЖриВ ри╡рйЗри▓рйЗ ринри╛риИ ри╕ри╛ри╣ри┐рим ридрикрижрйА ринрй▒риарйА ри╡ри┐рй▒риЪ ри╕ри╝ри░ригрйА ри╣рйЛриП; риЧрйБри░рйВ риХри┐ри░рикри╛ риири╛ри▓ риХрйБриЭ риирйБриХри╕ри╛рии римри┐риири╛ римриЪ риири┐риХри▓рйЗтАФриЗри╕ риери╛риВ рижрйА рипри╛риж ри╡рйА риЕрй▒риЬ риЧрйБри░рижрйБриЖри░рйЗ ри░рйВрик тАШриЪ ри╕ри╛риВринрйА ри╣рйЛриИ ри╣рйИред</p>
    `,
    map: "https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d27233.84138791328!2d74.86949983238525!3d31.1937777812888!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x391a7bc88a09f1cf%3A0x947c8934934efc8f!2sPatti%2C%20Punjab%20143416!5e0!3m2!1sen!2sin!4v1708548734338!5m2!1sen!2sin"
  },

  'british': {
    title: 'римрйНри░ри┐риЯри┐ри╕ри╝ ри╣риХрйВриорид',
    content: `
      <h4>римрйНри░ри┐риЯри┐ри╕ри╝ рижрйМри░ риЕридрйЗ ри╡рй░риб</h4>
      <p>риЙрй▒риирйАри╡рйАриВ ри╕рижрйА рижрйЗ рипри╛ридри░ри╛-ри╡ри░ригриири╛риВ ри╡ри┐рй▒риЪ рикрй▒риЯрйА рижрйА риЖримри╛рижрйА ри▓риЧринриЧ 5,000 рижри░риЬ риХрйАридрйА риори┐ри▓рижрйА ри╣рйИред риЖриЬри╝ри╛рижрйА ридрйЛриВ рикри╣ри┐ри▓ри╛риВ рикрй▒риЯрйА ри▓ри╛ри╣рйМри░ риЬри╝ри┐ри▓рйНри╣рйЗ рижрйА риЗрй▒риХ ридри╣ри┐ри╕рйАри▓ ри╕рйА; 1947 рижрйА ри╡рй░риб ридрйЛриВ римри╛риЕриж риЗри╣ риЕрй░риорйНри░ри┐ридри╕ри░ риЬри╝ри┐ри▓рйНри╣рйЗ рижрйЗ риЕризрйАрии риЖ риЧри┐риЖред ри╡рй░риб риири╛ри▓ ри╕риори╛риЬриХ-ризри╛ри░риори┐риХ римригридри░ ри╡ри┐рй▒риЪ рибрйВрй░риШрйАриЖриВ ридримрижрйАри▓рйАриЖриВ риЖриИриЖриВ; риЧри┐ри▓ри╛риирйА риЕридрйЗ риори┐ри░риЬри╝рйЗ ри╡ри░риЧрйЗ риХриИ рикрйБри░ри╛ридрии рикри░ри┐ри╡ри╛ри░ рикри╛риХри┐ри╕ридри╛рии риори╛риИриЧрйНри░рйЗриЯ риХри░ риЧриПред</p>
      <p>ри╡рй░риб-рикри┐риЫрйЛриВ рикрйНри░ри╕ри╝ри╛ри╕риХрйА ри░рйА-риЖри░риЧрйЗриири╛риИриЬри╝рйЗри╕ри╝рии риири╛ри▓ рикрй▒риЯрйА рижрйА риириЧри░ри┐риХ риЕридрйЗ риЖри░риери┐риХ ризрйБри░рйА римрижри▓рйА, рикри░ риЗридри┐ри╣ри╛ри╕риХ риври╛риВриЪри┐риЖриВ рижрйА ри╕рй░ринри╛ри▓ ри▓риИ ри▓рй░римрйЗ ри╕риорйЗриВ ридриХ ри╕ри┐ри╕риЯриорйИриЯри┐риХ рипридриири╛риВ рижрйА ри▓рйЛрйЬ риори╣ри┐ри╕рйВри╕ ри╣рйБрй░рижрйА ри░ри╣рйАред</p>
    `,
    map: "https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d27233.84138791328!2d74.86949983238525!3d31.1937777812888!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x391a7bc88a09f1cf%3A0x947c8934934efc8f!2sPatti%2C%20Punjab%20143416!5e0!3m2!1sen!2sin!4v1708548734338!5m2!1sen!2sin"
  },

  'modern': {
    title: 'риЖризрйБриири┐риХ риХри╛ри▓',
    content: `
      <h4>рикрйЛри╕риЯ-2006 рикрйНри░ри╕ри╝ри╛ри╕риХрйА ри╕рй░рижри░рин</h4>
      <p>2006 ри╡ри┐рй▒риЪ ридри░рии ридри╛ри░рии риирйВрй░ ри╡рй▒риЦри░ри╛ риЬри╝ри┐ри▓рйНри╣ри╛ римригри╛риП риЬри╛риг ридрйЛриВ римри╛риЕриж, рикрй▒риЯрйА риЗри╕ рижрйА риЗрй▒риХ риорйБрй▒риЦ ридри╣ри┐ри╕рйАри▓ ри╡риЬрйЛриВ риЙринри░рйАред риЕрй▒риЬ рикрй▒риЯрйА риЦрйЗридрйАримри╛рйЬрйА-риХрйЗриВрижри░ри┐рид риЖри░риери┐риХридри╛ риири╛ри▓-риири╛ри▓ ри╕ри┐рй▒риЦри┐риЖ, ри╕ри┐ри╣рид риЕридрйЗ риЖри╡ри╛риЬри╛риИ риври╛риВриЪрйЗ тАШриЪ ри╕рйБризри╛ри░ри╛риВ рижрйЗ ри░ри╛ри╣ тАШридрйЗ ри╣рйИред</p>

      <h4>ри╕риори╛риЬри┐риХ-ри╕рйБри░рй▒риЦри┐риЖ риЕридрйЗ ри╣ри╛ри▓рйАриЖ рижрйМри░</h4>
      <p>ри╕ри░ри╣рй▒рижрйА ри╕ри╝ри╣ри┐ри░ ри╡риЬрйЛриВ риХрйЛри╡ри┐риб-19 рижрйМри░ри╛рии риЯрйАриХри╛риХри░рии риорйБри╣ри┐рй░рио тАШриЪ ридрйЗриЬри╝риЧридрйА рижри┐риЦрйАред 1980 рижрйЗ рижри╣ри╛риХрйЗ рижрйЗ риЦрйЗридри░риХ риЕри╕риери┐ри░ридри╛ (риЦри╛рйЬриХрйВри╡ри╛риж) риирйЗ ри╡рйА рикрй▒риЯрйА-рикри╛ри╕рйЗ ри╕риори╛риЬри┐риХ-ри╕ри┐риЖри╕рйА риори╛ри╣рйМри▓ тАШридрйЗ рикрйНри░ринри╛ри╡ рикри╛риЗриЖтАФри╕ри░ри╣рй▒рижрйА риирйЗрйЬридри╛ риХри░риХрйЗ ри╕рй░ри╡рйЗрижриири╕ри╝рйАри▓ридри╛ ри╡ризрйА ри░ри╣рйАред</p>

      <h4>рикрй▒риЯрйА рижрйАриЖриВ рикрйНри░риорйБрй▒риЦ риЗридри┐ри╣ри╛ри╕риХ риЗриори╛ри░ридри╛риВ</h4>
      <ul>
        <li><strong>1755 рижри╛ риЗридри┐ри╣ри╛ри╕риХ риХри┐ри▓рйНри╣ри╛ (Patti Qila)</strong>: риорйБриЧри▓-ри╕ри┐рй▒риЦ рипрйБрй▒риЧ рижрйА риири┐ри╕ри╝ри╛риирйА; ри▓рй░риорйЗ ри╕риорйЗриВ ридриХ ри╕риери╛риириХ рикрйБри▓ри┐ри╕ ри╕риЯрйЗри╕ри╝рии риЗриерйЗ риЪрй▒ри▓рижри╛ ри░ри┐ри╣ри╛ред</li>
        <li><strong>ри╕ри╝ри╣ри┐ри░ рижрйА риХрй░риз</strong>: рикрйБри░ри╛ригрйА риШрйЗри░ри╛римрй░рижрйА риХрй░риз рижрйЗ риХрйБриЭ риЕри╡ри╕ри╝рйЗри╕ри╝ риЕрй▒риЬ ри╡рйА рижри┐рй▒ри╕рижрйЗ ри╣рииред</li>
        <li><strong>ри░ри╛риП/ри░ри╛риЬри╛ рижрйБриирйА риЪрй░риж рижрйА ри╣ри╡рйЗри▓рйА</strong>: риЗриерйЛриВ ри╣рйА римрйАримрйА ри░риЬриирйА рижрйА риХри╣ри╛ригрйА риЬрйБрйЬрижрйА ри╣рйИ; риХри┐ри▓ри╛-рикри░ри┐ри╕ри░ риири╛ри▓ рикри░рй░рикри░ри┐риХ ридрйМри░ тАШридрйЗ риЬрйЛрйЬрйА риЬри╛риВрижрйА ри╣рйИред</li>
        <li><strong>ри╕ри╝ри┐ри╡ риорй░рижри░ (рижрй▒риЦриг-рикрйВри░римрйА риЯри┐рй▒ри▓ри╛)</strong>: рикрйНри░ри╛риЪрйАрии ри╣ри┐рй░рижрйВ ризри╛ри░риори┐риХ ри╡ри┐ри░ри╛ри╕рид рижрйА риЭри▓риХред</li>
        <li><strong>риЧрйБри░рижрйБриЖри░ри╛ ри╕рйНри░рйА риЪрйМримри╛ри░ри╛ ри╕ри╛ри╣ри┐рим</strong>: ринри╛риИ римри┐ризрйА риЪрй░риж риЬрйА ри╡ри╛ри▓рйА рижрйБри╕ри╝ри╛ри▓ри┐риЖриВ рижрйА риХриери╛ риири╛ри▓ рикрйНри░ри╕ри┐рй▒ризтАФрикрйБри░ри╛ригрйЗ ри╣ри╛риХрио рижрйА ри░ри┐ри╣ри╛риЗри╕ри╝-риери╛риВ тАШридрйЗ ри╕риери┐рид риорй░риирйА риЬри╛риВрижрйА ри╣рйИред</li>
        <li><strong>риЧрйБри░рижрйБриЖри░ри╛ ри╕рйНри░рйА ринрй▒риа ри╕ри╛ри╣ри┐рим</strong>: ридрикрижрйА ринрй▒риарйА тАШриЪ ри╕ри╝ри░риг рижрйА риХриери╛ риири╛ри▓ риЬрйБрйЬри┐риЖ ри╕риери╛рииред</li>
        <li><strong>риЧри┐ри▓ри╛риирйА рикри░ри┐ри╡ри╛ри░ рижрйАриЖриВ риориЬри╝ри╛ри░ри╛риВ</strong>: ри╕рйВрилри╝рйА рикри░рй░рикри░ри╛ рижрйЗ ризри╛ри░риори┐риХ ри╕риери╛риири╛риВ рижрйА ри╕рйВриЭред</li>
      </ul>

      <h4>рикрй░риЬри╛рим рижрйА риЗридри┐ри╣ри╛ри╕риХ ри╕риери╛риириХ риХри╣ри╛ригрйАриЖриВ</h4>
      <p>рикрй▒риЯрйА риЕридрйЗ риЖри▓рйЗ-рижрйБриЖри▓рйЗ рижрйАриЖриВ ри╕риери╛риириХ риХри╣ри╛ригрйАриЖриВтАФримрйАримрйА ри░риЬриирйА, ринри╛риИ римри┐ризрйА риЪрй░риж, риЕридрйЗ риори┐ри╕ри▓-риХри╛ри▓ рижрйЗ риЬрй░риЧрйА риЕризри┐риЖриЗтАФрикрй░риЬри╛римрйА ри╕ри╛ри╣ри┐рид, риХри╡ри┐ридри╛ риЕридрйЗ ри▓рйЛриХ-риЧрйАридри╛риВ ри╡ри┐рй▒риЪ ри╡ри┐риЖрикриХ ри╣рииред риЗри╣ риХри╣ри╛ригрйАриЖриВ риЗриерйЛриВ рижрйЗ ри▓рйЛриХ-ризри╛ри░риори┐риХ ри╡ри┐ри╕ри╝ри╡ри╛ри╕, рижри┐ри▓рйЗри░рйА риЕридрйЗ ри╕риорйВри╣риХ ри╕рй░риШри░ри╕ри╝ рижрйАриЖриВ риири┐ри╕ри╝ри╛риирйАриЖриВ ри╣рииред</p>

      <h4>рикрй▒риЯрйА риЕридрйЗ рикрй░риЬри╛римрйА ри╕рй▒ринри┐риЖриЪри╛ри░</h4>
      <p>рикрй▒риЯрйА рижрйА рикрйНри░ринри╛ри╡ри╕ри╝ри╛ри▓рйА риЕринри┐ринри╛ри╡риХридри╛ риирйЗ рикрй░риЬри╛рим ри╡ри┐рй▒риЪ ризри╛ри░риори┐риХ, ри░ри╛риЬри╕рйА риЕридрйЗ риЖри░риери┐риХ ри╡ри┐ри░ри╛ри╕рид риирйВрй░ ри╡ризри╛риЗриЖред "рикрй▒риЯрйА" ри╕ри╝римриж риЦрйБриж риЧри▓рйА-риХрйЗриВрижри░ри┐рид римри╕ридрйАриЖриВ риЕридрйЗ ри╡рй░ри╕ри╝-риЖризри╛ри░ри┐рид ри╕риори╛риЬри┐риХ римригридри░ риирйВрй░ рижри░ри╕ри╛риЙриВрижри╛ ри╣рйИ; ри╕рйВрилри╝рйА (риЧри┐ри▓ри╛риирйА) риЕридрйЗ риЧрйБри░риорид риЕриирйБринри╡ри╛риВ рижрйА риори┐ри▓рйА-риЭрйБри▓рйА ризри╛ри░ри╛ риЗриерйЗ рижрйА ри░рй░риЧрид ри╣рйИред</p>

      <h4>ри╕рй░ринри╛ри▓ рижрйА ри▓рйЛрйЬ</h4>
      <p>риХри┐ри▓рйНри╣ри╛, ри╕ри╝ри╣ри┐ри░рйА риХрй░риз, ри╣ри╡рйИри▓рйАриЖриВ, риЧрйБри░рижрйБриЖри░рйЗ риЕридрйЗ риориЬри╝ри╛ри░ри╛риВтАФримри╣рйБридрйАриЖриВ риери╛ри╡ри╛риВ риЦрй░рибри░-ри╣ри╛ри▓ ри╣рйЛ ри░ри╣рйАриЖриВ ри╣рииред ри╕ри░риХри╛ри░ риЕридрйЗ ри╕риери╛риириХ ри╕риори╛риЬ рижрйА ри╕ри╛риВриЭрйА риХрйЛри╕ри╝ри┐ри╕ри╝, рижри╕ридри╛ри╡рйЗриЬри╝рйАриХри░рии, ризри░рйЛри╣ри░-риири╡рйАриирйАриХри░риг риЕридрйЗ риЬри╝ри┐рй░риорйЗри╡ри╛ри░ риЯрйВри░ри┐риЬри╝рио ри░ри╛ри╣рйАриВ риЖриЧри╛риорйА рикрйАрйЬрйНри╣рйАриЖриВ ри▓риИ риЗри╣ риЕриорйАри░ ри╡ри┐ри░ри╛ри╕рид ри╕рй░ринри╛ри▓рйА риЬри╛ ри╕риХрижрйА ри╣рйИред</p>

      <h4>ри╕ри╛ри░рйА риЧрй▒ри▓ рижри╛ ри╕ри╛ри░</h4>
      <p>рикрй▒риЯрйА рижри╛ риЗридри┐ри╣ри╛ри╕ ри▓риЧринриЧ риЗрй▒риХ ри╣риЬри╝ри╛ри░ ри╕ри╛ри▓ рикрйБри░ри╛ригри╛ риЕридрйЗ риХриери╛ри╡ри╛риВ риири╛ри▓ ринри░рикрйВри░ ри╣рйИтАФ"риирйМ ри▓рй▒риЦрйА рикрй▒риЯрйА" ридрйЛриВ риорйБриЧри▓ рикрйНри░ри╕ри╝ри╛ри╕рии, ри╕ри┐рй▒риЦ риЬрй▒риери┐риЖриВ рижрйЗ ри╣рйМриВри╕ри▓рйЗ-ри╕ри╝ри╣рйАрижрйАриЖриВ, риори┐ри╕ри▓ри╛риВ рижрйА ри░ри╛риЬриирйАрид, ри░ригриЬрйАридриХри╛ри▓рйА риЗриХри╛риИриХри░рии, ри╡рй░риб-рикри┐риЫрйЛриВ рикрйНри░ри╕ри╝ри╛ри╕риХрйА римрижри▓ри╛риЕ риЕридрйЗ риЕрй▒риЬ рижрйА риЙринри░рижрйА риириЧри░ри┐риХридри╛ ридрй▒риХтАФриЗри╣ ри╕рин риХрйБриЭ рикрй░риЬри╛римрйА ри╕рй▒ринри┐риЖриЪри╛ри░риХ рипри╛риж ри╡ри┐рй▒риЪ рикрй▒риЯрйА рижрйА риЗрй▒риХ риЦри╝ри╛ри╕ рикри╣ри┐риЪри╛риг римригри╛риЙриВрижри╛ ри╣рйИред</p>
    `,
    map: "https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d27233.84138791328!2d74.86949983238525!3d31.1937777812888!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x391a7bc88a09f1cf%3A0x947c8934934efc8f!2sPatti%2C%20Punjab%20143416!5e0!3m2!1sen!2sin!4v1708548734338!5m2!1sen!2sin"
  }
};

  // ========== 2) Element references ==========
  const timelineItems = document.querySelectorAll('.timeline-item');
  const modal = document.getElementById('history-modal');
  const modalTitle = document.getElementById('modal-title');
  const modalContentDiv = document.getElementById('modal-text-content');
  const modalImageContainer = document.getElementById('modal-image-container'); // reserved for future images
  const modalMapContainer = document.getElementById('modal-map-container');
  const closeModalBtn = document.getElementById('modal-close');
  const prevBtn = document.getElementById('prev-btn');
  const nextBtn = document.getElementById('next-btn');
  const jumpSelect = document.getElementById('jump-select'); // native select, navigates on change
  const modalBody = document.getElementById('modal-body') || modal?.querySelector('.modal-body') || modal;

  // ========== 3) Order and labels ==========
  const eras = ['ancient', 'mughal', 'sikh', 'british', 'modern'];
  const eraLabels = {
    ancient: 'рикрйБри░ри╛ридрии/риорй▒ризриХри╛ри▓',
    mughal:  'риорйБриЧри▓ риХри╛ри▓',
    sikh:    'ри╕ри┐рй▒риЦ ри░ри╛риЬ',
    british: 'римрйНри░ри┐риЯри┐ри╕ри╝/ри╡рй░риб',
    modern:  'риЖризрйБриири┐риХ риХри╛ри▓'
  };

  let currentEraIndex = 0;
  let focusTrapCleanup = null;

  // ========== 4) Modal Manager (supports multiple modals; close-all on demand) ==========
  const ModalManager = (() => {
    const MODAL_SELECTOR = '.modal-overlay';
    const STATE_KEY = 'modal';

    const allModals = () => Array.from(document.querySelectorAll(MODAL_SELECTOR));

    function isAnyModalOpen() {
      return allModals().some(m => m.getAttribute('aria-hidden') === 'false');
    }

    function openModal(modalEl) {
      modalEl.setAttribute('aria-hidden', 'false');
      modalEl.style.display = 'flex';
      document.body.style.overflow = 'hidden';
    }

    function hideModal(modalEl) {
      modalEl.setAttribute('aria-hidden', 'true');
      modalEl.style.display = 'none';
    }

    function closeAllModals() {
      allModals().forEach(hideModal);
      document.body.style.overflow = 'auto';
    }

    function pushModalState(extra = {}) {
      const state = { [STATE_KEY]: true, ...extra };
      try { history.pushState(state, '', location.hash || location.href); } catch {}
    }

    // Back/Forward integration: restore or clear modal state
    function onPopState(event) {
      const st = event.state;
      if (st && st[STATE_KEY]) {
        if (!isAnyModalOpen()) {
          const primary = document.querySelector(MODAL_SELECTOR);
          if (primary) openModal(primary);
        }
      } else {
        closeAllModals();
      }
    }

    window.addEventListener('popstate', onPopState); // History-driven behavior [1][3]

    return { openModal, closeAllModals, pushModalState };
  })();

  // ========== 5) Helpers for history modal ==========
  function setPrevNextLabels() {
    const hasPrev = currentEraIndex > 0;
    const hasNext = currentEraIndex < eras.length - 1;

    if (hasPrev) {
      const prevKey = eras[currentEraIndex - 1];
      prevBtn.textContent = `тЖР ${eraLabels[prevKey]}`;
      prevBtn.setAttribute('aria-label', `Previous: ${eraLabels[prevKey]}`);
      prevBtn.disabled = false;
    } else {
      prevBtn.textContent = 'тАФ';
      prevBtn.setAttribute('aria-label', 'No previous era');
      prevBtn.disabled = true;
    }

    if (hasNext) {
      const nextKey = eras[currentEraIndex + 1];
      nextBtn.textContent = `${eraLabels[nextKey]} тЖТ`;
      nextBtn.setAttribute('aria-label', `Next: ${eraLabels[nextKey]}`);
      nextBtn.disabled = false;
    } else {
      nextBtn.textContent = 'тАФ';
      nextBtn.setAttribute('aria-label', 'No next era');
      nextBtn.disabled = true;
    }
  }

  function updateJumpSelect() {
    if (jumpSelect) jumpSelect.value = eras[currentEraIndex];
  }

  function scrollModalToTop() {
    try { modalBody.scrollTo({ top: 0, behavior: 'smooth' }); } catch { modalBody.scrollTop = 0; }
  }

  function updateModalContent(eraIndex) {
    const eraKey = eras[eraIndex];
    const data = historyData[eraKey];
    modalTitle.textContent = data.title;
    modalContentDiv.innerHTML = data.content;
    modalMapContainer.innerHTML = `<iframe class="map" src="${data.map}" width="100%" height="250" style="border:0;" allowfullscreen="" loading="lazy"></iframe>`;
    currentEraIndex = eraIndex;
    setPrevNextLabels();
    updateJumpSelect();
    scrollModalToTop();
  }

  // Accessible focus trapping and keyboard controls per WAI-ARIA Dialog pattern
  function trapFocus(container) {
    const focusable = container.querySelectorAll('a[href], button:not([disabled]), select, [tabindex]:not([tabindex="-1"])');
    if (!focusable.length) return () => {};
    const first = focusable;
    const last = focusable[focusable.length - 1];

    function onKeydown(e) {
      if (e.key === 'Tab') {
        if (e.shiftKey && document.activeElement === first) { e.preventDefault(); last.focus(); }
        else if (!e.shiftKey && document.activeElement === last) { e.preventDefault(); first.focus(); }
      } else if (e.key === 'ArrowLeft') {
        e.preventDefault(); goPrevEra(true);
      } else if (e.key === 'ArrowRight') {
        e.preventDefault(); goNextEra(true);
      } else if (e.key === 'Escape') {
        e.preventDefault(); closeAllViaHistory();
      }
    }
    container.addEventListener('keydown', onKeydown);
    (closeModalBtn || first).focus();
    return () => container.removeEventListener('keydown', onKeydown);
  }

  function showModal() {
    ModalManager.openModal(modal);
    focusTrapCleanup = trapFocus(modal);
  }

  function hideModal() {
    modal.setAttribute('aria-hidden', 'true');
    modal.style.display = 'none';
    document.body.style.overflow = 'auto';
    if (focusTrapCleanup) { focusTrapCleanup(); focusTrapCleanup = null; }
  }

  // ========== 6) History API integration for modal open/era change ==========
  function pushEraState(eraIndex) {
    const key = eras[eraIndex];
    try { history.pushState({ modal: true, eraIndex }, '', `#history-${key}`); } catch {} // state drives Back/Forward [3][8]
  }

  function openEra(eraIndex, { pushState = false } = {}) {
    updateModalContent(eraIndex);
    if (modal.getAttribute('aria-hidden') === 'true') {
      showModal();
    }
    if (pushState) {
      pushEraState(eraIndex);
      ModalManager.pushModalState({ eraIndex }); // keep a modal state marker for cross-modal close [3][11]
    }
  }

  // Clicking close should close ALL modals (global requirement)
  function closeAllViaHistory() {
    try { history.back(); } catch {}
    // Safety fallback in case no state to go back to
    setTimeout(() => {
      if (modal.getAttribute('aria-hidden') === 'false') {
        ModalManager.closeAllModals();
      }
    }, 150);
  }

  // ========== 7) Wire timeline cards and interactions ==========
  timelineItems.forEach((item, index) => {
    item.addEventListener('click', () => openEra(index, { pushState: true }));
    item.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); openEra(index, { pushState: true }); }
    });
  });

  closeModalBtn.addEventListener('click', closeAllViaHistory);
  window.addEventListener('click', (event) => { if (event.target === modal) closeAllViaHistory(); });

  // Prev/Next with era labeling and history
  function goPrevEra(push = false) {
    if (currentEraIndex > 0) openEra(currentEraIndex - 1, { pushState: push });
  }
  function goNextEra(push = false) {
    if (currentEraIndex < eras.length - 1) openEra(currentEraIndex + 1, { pushState: push });
  }
  prevBtn.addEventListener('click', () => goPrevEra(true));
  nextBtn.addEventListener('click', () => goNextEra(true));

  // Jump-to era (native select) navigates immediately (no extra button)
  if (jumpSelect) {
    jumpSelect.addEventListener('change', (e) => {
      const key = e.target.value;
      const idx = eras.indexOf(key);
      if (idx >= 0) openEra(idx, { pushState: true });
    });
  }

  // Back/forward: restore prior era or close all modals
  window.addEventListener('popstate', (event) => {
    const state = event.state;
    if (state && state.modal === true && Number.isInteger(state.eraIndex)) {
      updateModalContent(state.eraIndex);
      if (modal.getAttribute('aria-hidden') === 'true') showModal();
    } else {
      // No modal state -> ensure all modals closed
      ModalManager.closeAllModals();
    }
  });

  // Deep-link: open era from hash on load
  const hash = location.hash;
  if (hash && hash.startsWith('#history-')) {
    const key = hash.replace('#history-', '');
    const idx = eras.indexOf(key);
    if (idx >= 0) {
      openEra(idx, { pushState: true });
    }
  }

  // ========== 8) Animated Number Counters (unchanged; independent from modal) ==========
  const elements = document.querySelectorAll('.animated-number');
  const observerOptions = { root: null, rootMargin: '0px', threshold: 0.5 };
  const observer = new IntersectionObserver((entries, observerRef) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        const target = entry.target;
        const endValue = parseInt(target.dataset.target, 10);
        const format = target.dataset.format;
        let startTimestamp = null;
        const duration = 2000;

        const step = (timestamp) => {
          if (!startTimestamp) startTimestamp = timestamp;
          const progress = timestamp - startTimestamp;
          const currentNumber = Math.min((progress / duration) * endValue, endValue);
          const formattedNumber = Math.floor(currentNumber).toLocaleString();
          target.textContent = formattedNumber + (format ? format : '');
          if (progress < duration) {
            window.requestAnimationFrame(step);
          } else {
            target.textContent = endValue.toLocaleString() + (format ? format : '');
          }
        };
        window.requestAnimationFrame(step);
        observerRef.unobserve(target);
      }
    });
  }, observerOptions);
  elements.forEach(el => observer.observe(el));
});
